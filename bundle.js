!function(t){var o={};function e(n){if(o[n])return o[n].exports;var i=o[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=t,e.c=o,e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,o){if(1&o&&(t=e(t)),8&o)return t;if(4&o&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&o&&"string"!=typeof t)for(var i in t)e.d(n,i,function(o){return t[o]}.bind(null,i));return n},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},e.p="",e(e.s=4)}([function(t,o,e){e(1);function n({pos:t,vel:o,radius:e,color:n}){this.pos=t,this.vel=o,this.radius=e,this.color=n}n.prototype.draw=function(t){const[o,e]=this.pos;t.fillStyle=this.color,t.beginPath(),t.arc(o,e,this.radius,0,2*Math.PI),t.fill()},n.prototype.move=function(t){const[o,e]=this.pos,[n,i]=this.vel;this.pos=t([o+n,e+i])},n.prototype.isWrappable=!0,t.exports=n},function(t,o,e){const n=e(6),i=e(7),s=(e(0),e(3)),r=function(){this.movingObjects=new Set;for(let t=0;t<r.NUM_ASTEROIDS;t++){const t=this.randomPostion(),o=new n({pos:t});this.add(o)}const t=this.randomPostion();this.ship=new i({pos:t},this),this.bullets=new Set};r.prototype.add=function(t){t instanceof n?this.movingObjects.add(t):t instanceof s&&this.bullets.add(t)},r.prototype.remove=function(t){t instanceof n?this.movingObjects.delete(t):t instanceof s&&this.bullets.delete(t)},r.prototype.randomPostion=function(){return[Math.random()*r.DIM_X,Math.random()*r.DIM_Y]},r.prototype.draw=function(t){t.clearRect(0,0,r.DIM_X,r.DIM_Y),this.allObjects().forEach(o=>o.draw(t))},r.prototype.moveObjects=function(){this.allObjects().forEach(t=>{t.isWrappable?t.move(this.wrap):t.move(o=>(this.isOutOfBounds(o)&&this.remove(t),o))})},r.prototype.wrap=function([t,o]){return[(t+r.DIM_X)%r.DIM_X,(o+r.DIM_Y)%r.DIM_Y]},r.prototype.checkCollisions=function(){this.movingObjects.forEach(t=>{this.ship.isCollidedWith(t)&&(this.relocate(this.ship),this.ship.reset())}),this.bullets.forEach(t=>{this.movingObjects.forEach(o=>{t.isCollidedWith(o)&&(this.remove(o),this.remove(t))})})},r.prototype.step=function(){this.moveObjects(),this.checkCollisions()},r.prototype.relocate=function(t){t.pos=this.randomPostion()},r.prototype.allObjects=function(){return[...this.movingObjects,this.ship,...this.bullets]},r.prototype.isOutOfBounds=function(t){const[o,e]=t;return o>r.DIM_X||o<0||e>r.DIM_Y||e<0},r.DIM_X=768,r.DIM_Y=512,r.NUM_ASTEROIDS=10,t.exports=r},function(t,o){const e={inherits(t,o){const e=function(){};e.prototype=o.prototype,t.prototype=new e,t.prototype.constructor=t},randomVec(t){const o=2*Math.PI*Math.random();return e.scale([Math.sin(o),Math.cos(o)],t)},scale:(t,o)=>[t[0]*o,t[1]*o]};t.exports=e},function(t,o,e){const n=e(0),i=e(2),s=function({pos:t,vel:o}){n.call(this,{pos:t,vel:o,radius:s.RADIUS,color:s.COLOR}),this.isWrappable=!1};s.RADIUS=2,s.COLOR="white",i.inherits(s,n),s.prototype.isCollidedWith=function(t){const[o,e]=this.pos,[n,i]=t.pos;return Math.sqrt((o-n)**2+(e-i)**2)<this.radius+t.radius},t.exports=s},function(t,o,e){"use strict";e.r(o);e(8);const n=e(5);document.addEventListener("DOMContentLoaded",(function(){(new n).start()}))},function(t,o,e){const n=e(1),i=function(){const t=document.getElementById("app-container");this.game=new n;const o=document.createElement("canvas"),e=o.getContext("2d");this.dimension={width:n.DIM_X,height:n.DIM_Y};const i=window.devicePixelRatio;o.width=n.DIM_X*i,o.height=n.DIM_Y*i,o.id="main-canvas",e.scale(i,i),o.tabIndex=1,o.autofocus=!0,t.appendChild(o),this.context=e,this.canvas=o};i.prototype.start=function(){this.bindKeyHandlers();const t=()=>{this.game.step(),this.game.draw(this.context),requestAnimationFrame(t)};t()},i.prototype.bindKeyHandlers=function(){key("W",()=>{this.game.ship.power([0,-1])}),key("S",()=>{this.game.ship.power([0,1])}),key("A",()=>{this.game.ship.power([-1,0])}),key("D",()=>{this.game.ship.power([1,0])}),key("space",()=>{this.game.ship.fireBullet()})},t.exports=i},function(t,o,e){const n=e(2),i=e(0),s=function({pos:t}){i.call(this,{pos:t,vel:n.randomVec(6*Math.random()+1),color:s.COLOR,radius:s.RADIUS})};s.COLOR="#666666",s.RADIUS=20,n.inherits(s,i),t.exports=s},function(t,o,e){const n=e(2),i=e(0),s=(e(1),e(3)),r=function({pos:t},o){i.call(this,{pos:t,radius:r.RADIUS,color:r.COLOR,vel:[0,0]}),this.game=o};r.RADIUS=15,r.COLOR="#31a5d9",n.inherits(r,i),r.prototype.reset=function(){this.vel=[0,0]},r.prototype.isCollidedWith=function(t){const[o,e]=this.pos,[n,i]=t.pos;return Math.sqrt((o-n)**2+(e-i)**2)<this.radius+t.radius},r.prototype.power=function(t){const[o,e]=this.vel,[n,i]=t;this.vel=[o+n,e+i]},r.prototype.fireBullet=function(){const t=this.pos,[o,e]=this.vel;if(0===o&&0===e)return;const n=new s({pos:t,vel:[5*o,5*e]});this.game.add(n)},t.exports=r},function(t,o,e){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL21vdmluZ19vYmplY3QuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzLmpzIiwid2VicGFjazovLy8uL3NyYy9idWxsZXQuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9nYW1lX3ZpZXcuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FzdGVyb2lkLmpzIiwid2VicGFjazovLy8uL3NyYy9zaGlwLmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiTW92aW5nT2JqZWN0IiwicG9zIiwidmVsIiwicmFkaXVzIiwiY29sb3IiLCJ0aGlzIiwiZHJhdyIsImNvbnRleHQiLCJ4IiwieSIsImZpbGxTdHlsZSIsImJlZ2luUGF0aCIsImFyYyIsIk1hdGgiLCJQSSIsImZpbGwiLCJtb3ZlIiwicG9zQ2FsbEJhY2siLCJkeCIsImR5IiwiaXNXcmFwcGFibGUiLCJBc3Rlcm9pZCIsIlNoaXAiLCJCdWxsZXQiLCJHYW1lIiwibW92aW5nT2JqZWN0cyIsIlNldCIsIk5VTV9BU1RFUk9JRFMiLCJyYW5kb21Qb3N0aW9uIiwiYXN0ZXJvaWQiLCJhZGQiLCJzaGlwIiwiYnVsbGV0cyIsInJlbW92ZSIsImRlbGV0ZSIsInJhbmRvbSIsIkRJTV9YIiwiRElNX1kiLCJjbGVhclJlY3QiLCJhbGxPYmplY3RzIiwiZm9yRWFjaCIsIm1vdmVPYmplY3RzIiwid3JhcCIsImlzT3V0T2ZCb3VuZHMiLCJjaGVja0NvbGxpc2lvbnMiLCJpc0NvbGxpZGVkV2l0aCIsInJlbG9jYXRlIiwicmVzZXQiLCJiIiwic3RlcCIsIlV0aWwiLCJDaGlsZENsYXNzIiwiUGFyZW50Q2xhc3MiLCJTdXJyb2dhdGUiLCJjb25zdHJ1Y3RvciIsImxlbmd0aCIsImRlZyIsInNjYWxlIiwic2luIiwiY29zIiwidmVjIiwiUkFESVVTIiwiQ09MT1IiLCJpbmhlcml0cyIsIm90aGVyT2JqZWN0IiwieDEiLCJ5MSIsIngyIiwieTIiLCJzcXJ0IiwiR2FtZVZpZXciLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJzdGFydCIsImFwcENvbnRhaW5lciIsImdldEVsZW1lbnRCeUlkIiwiZ2FtZSIsImNhbnZhcyIsImNyZWF0ZUVsZW1lbnQiLCJnZXRDb250ZXh0IiwiZGltZW5zaW9uIiwid2lkdGgiLCJoZWlnaHQiLCJkcHIiLCJ3aW5kb3ciLCJkZXZpY2VQaXhlbFJhdGlvIiwiaWQiLCJ0YWJJbmRleCIsImF1dG9mb2N1cyIsImFwcGVuZENoaWxkIiwiYmluZEtleUhhbmRsZXJzIiwicmVmcmVzaCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInBvd2VyIiwiZmlyZUJ1bGxldCIsInJhbmRvbVZlYyIsImltcHVsc2UiLCJpeCIsIml5IiwiYnVsbGV0Il0sIm1hcHBpbmdzIjoiYUFDRSxJQUFJQSxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVQyxRQUduQyxJQUFJQyxFQUFTSixFQUFpQkUsR0FBWSxDQUN6Q0csRUFBR0gsRUFDSEksR0FBRyxFQUNISCxRQUFTLElBVVYsT0FOQUksRUFBUUwsR0FBVU0sS0FBS0osRUFB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TUFBS0UsT0FBUW1CLEVBQUt1QyxPQUFRekQsTUFBT2tCLEVBQUt3QyxNQUFPNUQsSUFBSyxDQUFDLEVBQUUsS0FDOUVHLEtBQUt1RSxLQUFPQSxHQUdoQnRELEVBQUt1QyxPQUFTLEdBQ2R2QyxFQUFLd0MsTUFBUSxVQUNiWixFQUFLYSxTQUFTekMsRUFBTXRCLEdBRXBCc0IsRUFBSzFCLFVBQVVtRCxNQUFRLFdBQ3JCMUMsS0FBS0gsSUFBTSxDQUFDLEVBQUcsSUFPakJvQixFQUFLMUIsVUFBVWlELGVBQWlCLFNBQVNtQixHQUV2QyxNQUFPQyxFQUFJQyxHQUFNN0QsS0FBS0osS0FDZmtFLEVBQUlDLEdBQU1KLEVBQVkvRCxJQUM3QixPQUFPWSxLQUFLd0QsTUFBTUosRUFBS0UsSUFBTyxHQUFLRCxFQUFLRSxJQUFPLEdBQUsvRCxLQUFLRixPQUFTNkQsRUFBWTdELFFBR2hGbUIsRUFBSzFCLFVBQVVpRyxNQUFRLFNBQVNHLEdBQzlCLE1BQU85RSxFQUFJQyxHQUFNZCxLQUFLSCxLQUNmK0YsRUFBSUMsR0FBTUYsRUFDakIzRixLQUFLSCxJQUFNLENBQUNnQixFQUFLK0UsRUFBSTlFLEVBQUsrRSxJQUc1QjVFLEVBQUsxQixVQUFVa0csV0FBYSxXQUUxQixNQUFNN0YsRUFBTUksS0FBS0osS0FDVmlCLEVBQUlDLEdBQU1kLEtBQUtILElBQ3RCLEdBQVcsSUFBUGdCLEdBQW1CLElBQVBDLEVBQVUsT0FDMUIsTUFDTWdGLEVBQVMsSUFBSTVFLEVBQU8sQ0FBQ3RCLE1BQUtDLElBRHBCLENBQU0sRUFBTGdCLEVBQWEsRUFBTEMsS0FHckJkLEtBQUt1RSxLQUFLOUMsSUFBSXFFLElBSWhCcEksRUFBT0QsUUFBVXdELEciLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDQpO1xuIiwiY29uc3QgR2FtZSA9IHJlcXVpcmUoJy4vZ2FtZScpO1xuXG4vKipcbiAqIFxuICogQHBhcmFtIHt7cG9zOiBbbnVtYmVyLCBudW1iZXJdLCB2ZWw6IFtudW1iZXIsIG51bWJlcl0sIHJhZGl1czogbnVtYmVyLCBjb2xvcjogc3RyaW5nfX0gcGFyYW0wIG9wdGlvbiBvYmplY3RcbiAqIEBwYXJhbSB7R2FtZX0gZ2FtZVxuICovXG5mdW5jdGlvbiBNb3ZpbmdPYmplY3Qoe3BvcywgdmVsLCByYWRpdXMsIGNvbG9yfSkge1xuICB0aGlzLnBvcyA9IHBvcztcbiAgdGhpcy52ZWwgPSB2ZWw7XG4gIHRoaXMucmFkaXVzID0gcmFkaXVzO1xuICB0aGlzLmNvbG9yID0gY29sb3I7XG59XG5cbi8qKlxuICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGNvbnRleHRcbiAqL1xuXG5Nb3ZpbmdPYmplY3QucHJvdG90eXBlLmRyYXcgPSBmdW5jdGlvbihjb250ZXh0KSB7XG4gIGNvbnN0IFt4LCB5XSA9IHRoaXMucG9zO1xuICBjb250ZXh0LmZpbGxTdHlsZSA9IHRoaXMuY29sb3I7XG4gIGNvbnRleHQuYmVnaW5QYXRoKCk7XG4gIGNvbnRleHQuYXJjKFxuICAgIHgsIHksIHRoaXMucmFkaXVzLCAwLCAyICogTWF0aC5QSVxuICApO1xuICBjb250ZXh0LmZpbGwoKTtcbn07XG5cbk1vdmluZ09iamVjdC5wcm90b3R5cGUubW92ZSA9IGZ1bmN0aW9uKHBvc0NhbGxCYWNrKSB7XG4gIGNvbnN0IFt4LCB5XSA9IHRoaXMucG9zO1xuICBjb25zdCBbZHgsIGR5XSA9IHRoaXMudmVsO1xuICB0aGlzLnBvcyA9IHBvc0NhbGxCYWNrKFt4ICsgZHgsIHkgKyBkeV0pO1xufTtcblxuTW92aW5nT2JqZWN0LnByb3RvdHlwZS5pc1dyYXBwYWJsZSA9IHRydWU7XG5cblxuXG5tb2R1bGUuZXhwb3J0cyA9IE1vdmluZ09iamVjdDsiLCJjb25zdCBBc3Rlcm9pZCA9IHJlcXVpcmUoXCIuL2FzdGVyb2lkLmpzXCIpO1xuY29uc3QgU2hpcCA9IHJlcXVpcmUoXCIuL3NoaXBcIik7XG5jb25zdCBNb3ZpbmdPYmplY3QgPSByZXF1aXJlKFwiLi9tb3Zpbmdfb2JqZWN0XCIpO1xuY29uc3QgQnVsbGV0ID0gcmVxdWlyZSgnLi9idWxsZXQnKTtcblxuY29uc3QgR2FtZSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5tb3ZpbmdPYmplY3RzID0gbmV3IFNldCgpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IEdhbWUuTlVNX0FTVEVST0lEUzsgaSsrKSB7XG4gICAgY29uc3QgcG9zID0gdGhpcy5yYW5kb21Qb3N0aW9uKCk7XG4gICAgY29uc3QgYXN0ZXJvaWQgPSBuZXcgQXN0ZXJvaWQoeyBwb3MgfSk7XG4gICAgdGhpcy5hZGQoYXN0ZXJvaWQpO1xuICB9XG4gIGNvbnN0IHBvcyA9IHRoaXMucmFuZG9tUG9zdGlvbigpO1xuICB0aGlzLnNoaXAgPSBuZXcgU2hpcCh7IHBvcyB9LCB0aGlzKTtcbiAgdGhpcy5idWxsZXRzID0gbmV3IFNldCgpO1xufVxuXG5HYW1lLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gIGlmIChvYmplY3QgaW5zdGFuY2VvZiBBc3Rlcm9pZCkge1xuICAgIHRoaXMubW92aW5nT2JqZWN0cy5hZGQob2JqZWN0KTtcbiAgfSBlbHNlIGlmIChvYmplY3QgaW5zdGFuY2VvZiBCdWxsZXQpIHtcbiAgICB0aGlzLmJ1bGxldHMuYWRkKG9iamVjdCk7XG4gIH1cbn1cblxuR2FtZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICBpZiAob2JqZWN0IGluc3RhbmNlb2YgQXN0ZXJvaWQpIHtcbiAgICB0aGlzLm1vdmluZ09iamVjdHMuZGVsZXRlKG9iamVjdCk7XG4gIH0gZWxzZSBpZiAob2JqZWN0IGluc3RhbmNlb2YgQnVsbGV0KSB7XG4gICAgdGhpcy5idWxsZXRzLmRlbGV0ZShvYmplY3QpO1xuICB9XG59XG5cblxuR2FtZS5wcm90b3R5cGUucmFuZG9tUG9zdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIFsoTWF0aC5yYW5kb20oKSAqIEdhbWUuRElNX1gpLCAoTWF0aC5yYW5kb20oKSAqIEdhbWUuRElNX1kpXTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dFxuICovXG5HYW1lLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgR2FtZS5ESU1fWCwgR2FtZS5ESU1fWSk7XG4gIHRoaXMuYWxsT2JqZWN0cygpLmZvckVhY2gobyA9PiBvLmRyYXcoY29udGV4dCkpO1xufVxuXG5HYW1lLnByb3RvdHlwZS5tb3ZlT2JqZWN0cyA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5hbGxPYmplY3RzKCkuZm9yRWFjaChvID0+IHtcbiAgICBpZiAoby5pc1dyYXBwYWJsZSkge1xuICAgICAgby5tb3ZlKHRoaXMud3JhcCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG8ubW92ZShwb3MgPT4ge1xuICAgICAgICBpZiAodGhpcy5pc091dE9mQm91bmRzKHBvcykpIHRoaXMucmVtb3ZlKG8pO1xuICAgICAgICByZXR1cm4gcG9zO1xuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge1tudW1iZXIsIG51bWJlcl19XG4gKiBAcmV0dXJucyB7W251bWJlciwgbnVtYmVyXX1cbiAqL1xuR2FtZS5wcm90b3R5cGUud3JhcCA9IGZ1bmN0aW9uIChbeCwgeV0pIHtcbiAgcmV0dXJuIFsoeCArIEdhbWUuRElNX1gpICUgR2FtZS5ESU1fWCwgKHkgKyBHYW1lLkRJTV9ZKSAlIEdhbWUuRElNX1ldO1xufVxuXG5HYW1lLnByb3RvdHlwZS5jaGVja0NvbGxpc2lvbnMgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMubW92aW5nT2JqZWN0cy5mb3JFYWNoKG8gPT4ge1xuICAgIGlmICh0aGlzLnNoaXAuaXNDb2xsaWRlZFdpdGgobykpIHtcbiAgICAgIHRoaXMucmVsb2NhdGUodGhpcy5zaGlwKTtcbiAgICAgIHRoaXMuc2hpcC5yZXNldCgpO1xuICAgIH1cbiAgfSlcbiAgdGhpcy5idWxsZXRzLmZvckVhY2goYiA9PiB7XG4gICAgdGhpcy5tb3ZpbmdPYmplY3RzLmZvckVhY2gobyA9PiB7XG4gICAgICBpZiAoYi5pc0NvbGxpZGVkV2l0aChvKSkge1xuICAgICAgICB0aGlzLnJlbW92ZShvKTtcbiAgICAgICAgdGhpcy5yZW1vdmUoYik7XG4gICAgICB9XG4gICAgfSlcbiAgfSlcbn1cblxuR2FtZS5wcm90b3R5cGUuc3RlcCA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5tb3ZlT2JqZWN0cygpO1xuICB0aGlzLmNoZWNrQ29sbGlzaW9ucygpO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7TW92aW5nT2JqZWN0fSBvYmplY3RcbiAqL1xuR2FtZS5wcm90b3R5cGUucmVsb2NhdGUgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gIG9iamVjdC5wb3MgPSB0aGlzLnJhbmRvbVBvc3Rpb24oKTtcbn1cblxuLyoqXG4gKiBAcmV0dXJucyB7QXJyYXk8TW92aW5nT2JqZWN0Pn1cbiAqL1xuR2FtZS5wcm90b3R5cGUuYWxsT2JqZWN0cyA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIFsuLi50aGlzLm1vdmluZ09iamVjdHMsIHRoaXMuc2hpcCwgLi4udGhpcy5idWxsZXRzXTtcbn1cblxuR2FtZS5wcm90b3R5cGUuaXNPdXRPZkJvdW5kcyA9IGZ1bmN0aW9uKHBvcykge1xuICBjb25zdCBbeCwgeV0gPSBwb3M7XG4gIHJldHVybiB4ID4gR2FtZS5ESU1fWCB8fCB4IDwgMCB8fCB5ID4gR2FtZS5ESU1fWSB8fCB5IDwgMDtcbn1cblxuR2FtZS5ESU1fWCA9IDc2ODtcbkdhbWUuRElNX1kgPSA1MTI7XG5HYW1lLk5VTV9BU1RFUk9JRFMgPSAxMDtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lOyIsImNvbnN0IFV0aWwgPSB7XG4gIGluaGVyaXRzKENoaWxkQ2xhc3MsIFBhcmVudENsYXNzKSB7XG4gICAgY29uc3QgU3Vycm9nYXRlID0gZnVuY3Rpb24oKSB7fTtcbiAgICBTdXJyb2dhdGUucHJvdG90eXBlID0gUGFyZW50Q2xhc3MucHJvdG90eXBlO1xuICAgIENoaWxkQ2xhc3MucHJvdG90eXBlID0gbmV3IFN1cnJvZ2F0ZSgpO1xuICAgIENoaWxkQ2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ2hpbGRDbGFzcztcbiAgfSxcbiAgcmFuZG9tVmVjKGxlbmd0aCkge1xuICAgIGNvbnN0IGRlZyA9IDIgKiBNYXRoLlBJICogTWF0aC5yYW5kb20oKTtcbiAgICByZXR1cm4gVXRpbC5zY2FsZShbTWF0aC5zaW4oZGVnKSwgTWF0aC5jb3MoZGVnKV0sIGxlbmd0aCk7XG4gIH0sXG4gIC8vIFNjYWxlIHRoZSBsZW5ndGggb2YgYSB2ZWN0b3IgYnkgdGhlIGdpdmVuIGFtb3VudC5cbiAgc2NhbGUodmVjLCBtKSB7XG4gICAgcmV0dXJuIFt2ZWNbMF0gKiBtLCB2ZWNbMV0gKiBtXTtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBVdGlsOyIsImNvbnN0IE1vdmluZ09iamVjdCA9IHJlcXVpcmUoJy4vbW92aW5nX29iamVjdCcpO1xuY29uc3QgVXRpbCA9IHJlcXVpcmUoJy4vdXRpbHMnKVxuXG5jb25zdCBCdWxsZXQgPSBmdW5jdGlvbih7cG9zLCB2ZWx9KSB7XG4gIE1vdmluZ09iamVjdC5jYWxsKHRoaXMsIHtwb3MsIHZlbCwgcmFkaXVzOiBCdWxsZXQuUkFESVVTLCBjb2xvcjogQnVsbGV0LkNPTE9SfSk7XG4gIHRoaXMuaXNXcmFwcGFibGUgPSBmYWxzZTtcbn1cblxuQnVsbGV0LlJBRElVUyA9IDI7XG5CdWxsZXQuQ09MT1IgPSBcIndoaXRlXCI7XG5cblV0aWwuaW5oZXJpdHMoQnVsbGV0LCBNb3ZpbmdPYmplY3QpO1xuXG5CdWxsZXQucHJvdG90eXBlLmlzQ29sbGlkZWRXaXRoID0gZnVuY3Rpb24ob3RoZXJPYmplY3QpIHtcbiAgY29uc3QgW3gxLCB5MV0gPSB0aGlzLnBvcztcbiAgY29uc3QgW3gyLCB5Ml0gPSBvdGhlck9iamVjdC5wb3M7XG4gIHJldHVybiBNYXRoLnNxcnQoKHgxIC0geDIpICoqIDIgKyAoeTEgLSB5MikgKiogMikgPCB0aGlzLnJhZGl1cyArIG90aGVyT2JqZWN0LnJhZGl1cztcbn1cblxuXG5cbm1vZHVsZS5leHBvcnRzID0gQnVsbGV0OyIsImNvbnN0IEdhbWVWaWV3ID0gcmVxdWlyZShcIi4vZ2FtZV92aWV3XCIpO1xuaW1wb3J0ICcuLi9jc3Mvc3R5bGUuc2Nzcyc7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IGdhbWUgPSBuZXcgR2FtZVZpZXcoKTtcbiAgICBnYW1lLnN0YXJ0KCk7XG59KVxuXG4iLCJjb25zdCBHYW1lID0gcmVxdWlyZShcIi4vZ2FtZVwiKTtcblxuY29uc3QgR2FtZVZpZXcgPSBmdW5jdGlvbigpIHtcblxuICBjb25zdCBhcHBDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFwcC1jb250YWluZXJcIik7XG5cbiAgdGhpcy5nYW1lID0gbmV3IEdhbWUoKTtcblxuICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgdGhpcy5kaW1lbnNpb24gPSB7IHdpZHRoOiBHYW1lLkRJTV9YLCBoZWlnaHQ6IEdhbWUuRElNX1kgfVxuICBjb25zdCBkcHIgPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbztcbiAgY2FudmFzLndpZHRoID0gR2FtZS5ESU1fWCAqIGRwcjtcbiAgY2FudmFzLmhlaWdodCA9IEdhbWUuRElNX1kgKiBkcHI7XG4gIGNhbnZhcy5pZCA9IFwibWFpbi1jYW52YXNcIjtcbiAgY29udGV4dC5zY2FsZShkcHIsIGRwcik7XG4gIGNhbnZhcy50YWJJbmRleCA9IDE7XG4gIGNhbnZhcy5hdXRvZm9jdXMgPSB0cnVlO1xuICBhcHBDb250YWluZXIuYXBwZW5kQ2hpbGQoY2FudmFzKTtcblxuICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICB0aGlzLmNhbnZhcyA9IGNhbnZhcztcblxufVxuXG5HYW1lVmlldy5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5iaW5kS2V5SGFuZGxlcnMoKTtcbiAgY29uc3QgcmVmcmVzaCA9ICgpID0+IHtcbiAgICB0aGlzLmdhbWUuc3RlcCgpO1xuICAgIHRoaXMuZ2FtZS5kcmF3KHRoaXMuY29udGV4dCk7XG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlZnJlc2gpO1xuICB9XG4gIHJlZnJlc2goKTtcbn1cblxuR2FtZVZpZXcucHJvdG90eXBlLmJpbmRLZXlIYW5kbGVycyA9IGZ1bmN0aW9uKCkge1xuICBrZXkoJ1cnLCAoKSA9PiB7XG4gICAgdGhpcy5nYW1lLnNoaXAucG93ZXIoWzAsIC0xXSk7XG4gIH0pXG4gIGtleSgnUycsICgpID0+IHtcbiAgICB0aGlzLmdhbWUuc2hpcC5wb3dlcihbMCwgMV0pO1xuICB9KVxuICBrZXkoJ0EnLCAoKSA9PiB7XG4gICAgdGhpcy5nYW1lLnNoaXAucG93ZXIoWy0xLCAwXSk7XG4gIH0pXG4gIGtleSgnRCcsICgpID0+IHtcbiAgICB0aGlzLmdhbWUuc2hpcC5wb3dlcihbMSwgMF0pO1xuICB9KVxuICBrZXkoXCJzcGFjZVwiLCAoKSA9PiB7XG4gICAgICB0aGlzLmdhbWUuc2hpcC5maXJlQnVsbGV0KCk7XG4gIH0pXG59XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZVZpZXc7IiwiY29uc3QgVXRpbCA9IHJlcXVpcmUoJy4vdXRpbHMnKVxuY29uc3QgTW92aW5nT2JqZWN0ID0gcmVxdWlyZSgnLi9tb3Zpbmdfb2JqZWN0Jyk7XG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7e3BvczogW251bWJlciwgbnVtYmVyXX19IHBhcmFtMCBvcHRpb25zXG4gKi9cbmNvbnN0IEFzdGVyb2lkID0gZnVuY3Rpb24gKHsgcG9zIH0pIHtcbiAgTW92aW5nT2JqZWN0LmNhbGwodGhpcywge1xuICAgIHBvcyxcbiAgICB2ZWw6IFV0aWwucmFuZG9tVmVjKE1hdGgucmFuZG9tKCkgKiA2ICsgMSksXG4gICAgY29sb3I6IEFzdGVyb2lkLkNPTE9SLFxuICAgIHJhZGl1czogQXN0ZXJvaWQuUkFESVVTXG4gIH0pXG59O1xuXG5Bc3Rlcm9pZC5DT0xPUiA9IFwiIzY2NjY2NlwiO1xuQXN0ZXJvaWQuUkFESVVTID0gMjA7XG5cblV0aWwuaW5oZXJpdHMoQXN0ZXJvaWQsIE1vdmluZ09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gQXN0ZXJvaWQ7IiwiY29uc3QgVXRpbCA9IHJlcXVpcmUoXCIuL3V0aWxzXCIpO1xuY29uc3QgTW92aW5nT2JqZWN0ID0gcmVxdWlyZShcIi4vbW92aW5nX29iamVjdFwiKTtcbmNvbnN0IEdhbWUgPSByZXF1aXJlKCcuL2dhbWUnKTtcbmNvbnN0IEJ1bGxldCA9IHJlcXVpcmUoJy4vYnVsbGV0Jyk7XG5cbi8qKlxuICogXG4gKiBAcGFyYW0ge3twb3M6IFtudW1iZXIsIG51bWJlcl19fSBwYXJhbTAgb3B0aW9uc1xuICogQHBhcmFtIHtHYW1lfSBnYW1lIFxuICovXG5jb25zdCBTaGlwID0gZnVuY3Rpb24oe3Bvc30sIGdhbWUpIHtcbiAgICBNb3ZpbmdPYmplY3QuY2FsbCh0aGlzLCB7cG9zLCByYWRpdXM6IFNoaXAuUkFESVVTLCBjb2xvcjogU2hpcC5DT0xPUiwgdmVsOiBbMCwwXX0pO1xuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG59XG5cblNoaXAuUkFESVVTID0gMTU7XG5TaGlwLkNPTE9SID0gXCIjMzFhNWQ5XCI7XG5VdGlsLmluaGVyaXRzKFNoaXAsIE1vdmluZ09iamVjdClcblxuU2hpcC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy52ZWwgPSBbMCwgMF07XG59XG5cbi8qKlxuICogQHBhcmFtIHtNb3ZpbmdPYmplY3R9IG90aGVyT2JqZWN0XG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xuU2hpcC5wcm90b3R5cGUuaXNDb2xsaWRlZFdpdGggPSBmdW5jdGlvbihvdGhlck9iamVjdCkge1xuXG4gIGNvbnN0IFt4MSwgeTFdID0gdGhpcy5wb3M7XG4gIGNvbnN0IFt4MiwgeTJdID0gb3RoZXJPYmplY3QucG9zO1xuICByZXR1cm4gTWF0aC5zcXJ0KCh4MSAtIHgyKSAqKiAyICsgKHkxIC0geTIpICoqIDIpIDwgdGhpcy5yYWRpdXMgKyBvdGhlck9iamVjdC5yYWRpdXM7XG59O1xuXG5TaGlwLnByb3RvdHlwZS5wb3dlciA9IGZ1bmN0aW9uKGltcHVsc2UpIHtcbiAgY29uc3QgW2R4LCBkeV0gPSB0aGlzLnZlbDtcbiAgY29uc3QgW2l4LCBpeV0gPSBpbXB1bHNlO1xuICB0aGlzLnZlbCA9IFtkeCArIGl4LCBkeSArIGl5XTtcbn1cblxuU2hpcC5wcm90b3R5cGUuZmlyZUJ1bGxldCA9IGZ1bmN0aW9uKCkge1xuXG4gIGNvbnN0IHBvcyA9IHRoaXMucG9zO1xuICBjb25zdCBbZHgsIGR5XSA9IHRoaXMudmVsO1xuICBpZiAoZHggPT09IDAgJiYgZHkgPT09IDApIHJldHVybjtcbiAgY29uc3QgdmVsID0gW2R4ICogNSwgZHkgKiA1XTtcbiAgY29uc3QgYnVsbGV0ID0gbmV3IEJ1bGxldCh7cG9zLCB2ZWx9KTtcbiAgXG4gIHRoaXMuZ2FtZS5hZGQoYnVsbGV0KTtcbiAgXG59XG5cbm1vZHVsZS5leHBvcnRzID0gU2hpcDsiXSwic291cmNlUm9vdCI6IiJ9